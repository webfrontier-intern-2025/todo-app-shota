<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{{ page_title }}</title>

    <link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}">

</head>
<body>
    <h1>{{ page_title }}</h1>

    <!-- ★★★ レイアウト調整のためdivで囲む ★★★ -->
    <div id="page-header">
        <a href="/todo/new" class="new-todo-link">新しいTODOを作成する</a>

        <div id="tag-management-container">
            <section id="create-tag-section">
                <h2>新しいタグを作成</h2>
            <form onsubmit="createTag(event)" style="display: flex; gap: 0.5em;">
                <input type="text" id="new-tag-name" placeholder="タグ名(例: 仕事、勉強など)" required style="flex-grow: 1; padding: 0.5em; border: 1px solid #ddd; border-radius: 4px;">
                <button type="submit" style="background-color: #28a745; color: white; padding: 0.5em 1em; border: none; border-radius: 4px; cursor: pointer;">作成</button>
            </form>
            </section>

            <section id="manage-tags-section">
                <h2>作成済みのタグ</h2>
                <ul id="tag-list">
                    <li>タグがありません。新しいタグを作成してください。</li>
                </ul>
            </section>
        </div>
    </div>

    <h2>TODO一覧</h2>
    <ul id="todo-list">
        {% for todo in todos %}
            <li class="{{ 'completed' if todo.completed else '' }}" data-todo-id="{{ todo.id }}">
                <div class="todo-main">
                    <div class="content">

                        <input 
                            type="checkbox" 
                            class="todo-checkbox" 
                            id="todo-{{ todo.id }}" 
                            {% if todo.completed %}checked{% endif %} 
                            onchange="toggleTodoStatus({{ todo.id }}, this.checked)">


                        <span>{{ todo.content }}</span>

                        {% if todo.deadline %}
                           <span class="deadline">(締切: {{ todo.deadline }})</span>
                        {% endif %} 

                        <span class="tags">
                            {% for tag in todo.tags %}
                                <span class="tag">
                                    {{ tag.name }}
                                    <button class="remove-tag-btn" onclick="removeTag(event, {{ todo.id }}, {{ tag.id }})">[X]</button>
                                </span>
                            {% endfor %}
                        </span>
                    </div>
                    <div class="actions">
                        <a href="/todo/{{ todo.id }}/edit" class="edit">[編集]</a>
                        <a href="#" class="delete" onclick="deleteTodo(event, {{ todo.id }})">[削除]</a>
                    </div>
                </div>

                <div class="add-tag-form">
                    <label for="tag-select-{{ todo.id }}">タグ追加:</label>
                    <select id="tag-select-{{ todo.id }}" name="tag_id">
                        <option value="">-- タグを選択 --</option>
                    </select>
                    <button onclick="addTag({{ todo.id }})">追加</button>
                </div>

            </li>
        {% else %}
            <li>まだToDoはありません。</li>
        {% endfor %}
    </ul>

   <script src="{{ url_for('static', path='/js/main.js') }}"></script>
    <footer>
    <p>&copy; 2025 HatakeyamashotaのToDoアプリ. All Rights Reserved.</p>
    <p>
        <a href="/licenses">ライセンスについて</a>
    </p>
</footer>
</body>
</html>